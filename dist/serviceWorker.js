/*! For license information please see serviceWorker.js.LICENSE.txt */
(()=>{"use strict";function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(){var t,e,r="function"==typeof Symbol?Symbol:{},c=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(n,r,c,a){var i=r&&r.prototype instanceof u?r:u,l=Object.create(i.prototype);return o(l,"_invoke",function(n,o,r){var c,a,i,u=0,l=r||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(n,o){return c=n,a=0,i=t,p.n=o,s}};function d(n,o){for(a=n,i=o,e=0;!f&&u&&!r&&e<l.length;e++){var r,c=l[e],d=p.p,y=c[2];n>3?(r=y===o)&&(i=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=t):c[0]<=d&&((r=n<2&&d<c[1])?(a=0,p.v=o,p.n=c[1]):d<y&&(r=n<3||c[0]>o||o>y)&&(c[4]=n,c[5]=o,p.n=y,a=0))}if(r||n>1)return s;throw f=!0,o}return function(r,l,y){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,y),a=l,i=y;(e=a<2?t:i)||!f;){c||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(u=2,c){if(a||(r="next"),e=c[r]){if(!(e=e.call(c,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,a<2&&(a=0)}else 1===a&&(e=c.return)&&e.call(c),a<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),a=1);c=t}else if((e=(f=p.n<0)?i:n.call(o,p))!==s)break}catch(n){c=t,a=1,i=n}finally{u=1}}return{value:e,done:f}}}(n,c,a),!0),l}var s={};function u(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][c]?e(e([][c]())):(o(e={},c,function(){return this}),e),d=f.prototype=u.prototype=Object.create(p);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o(t,a,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=f,o(d,"constructor",f),o(f,"constructor",l),l.displayName="GeneratorFunction",o(f,a,"GeneratorFunction"),o(d),o(d,a,"Generator"),o(d,c,function(){return this}),o(d,"toString",function(){return"[object Generator]"}),(n=function(){return{w:i,m:y}})()}function o(t,n,e,r){var c=Object.defineProperty;try{c({},"",{})}catch(t){c=0}o=function(t,n,e,r){function a(n,e){o(t,n,function(t){return this._invoke(n,e,t)})}n?c?c(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e:(a("next",0),a("throw",1),a("return",2))},o(t,n,e,r)}function e(t,n){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),o.push.apply(o,e)}return o}function r(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach(function(n){c(t,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))})}return t}function c(n,o,e){return(o=function(n){var o=function(n){if("object"!=t(n)||!n)return n;var o=n[Symbol.toPrimitive];if(void 0!==o){var e=o.call(n,"string");if("object"!=t(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==t(o)?o:o+""}(o))in n?Object.defineProperty(n,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[o]=e,n}function a(t,n,o,e,r,c,a){try{var i=t[c](a),s=i.value}catch(t){return void o(t)}i.done?n(s):Promise.resolve(s).then(e,r)}function i(t){return function(){var n=this,o=arguments;return new Promise(function(e,r){var c=t.apply(n,o);function i(t){a(c,e,r,i,s,"next",t)}function s(t){a(c,e,r,i,s,"throw",t)}i(void 0)})}}var s="salesforce_data";function u(){return l.apply(this,arguments)}function l(){return(l=i(n().m(function t(){return n().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){chrome.storage.local.get([s],function(n){var o=n[s]||{leads:[],contacts:[],accounts:[],opportunities:[],tasks:[],metadata:{lastSync:{leads:null,contacts:null,accounts:null,opportunities:null,tasks:null},totalRecords:{leads:0,contacts:0,accounts:0,opportunities:0,tasks:0},opportunityStages:{prospecting:0,qualification:0,proposal:0,negotiation:0,closedWon:0,closedLost:0}}};t(o)})}))},t)}))).apply(this,arguments)}function f(t){return p.apply(this,arguments)}function p(){return(p=i(n().m(function t(o){return n().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){chrome.storage.local.set(c({},s,o),function(){t()})}))},t)}))).apply(this,arguments)}function d(t,n){return y.apply(this,arguments)}function y(){return(y=i(n().m(function t(o,e){var r,c;return n().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,u();case 1:return(r=t.v)[o]||(r[o]=[]),c=v(r[o],e),r[o]=c,g(r,o),t.n=2,f(r);case 2:return t.a(2,c)}},t)}))).apply(this,arguments)}function v(t,n){var o=new Map;return t.forEach(function(t){o.set(t.id,t)}),n.forEach(function(t){if(t.id){var n=o.get(t.id);n?o.set(t.id,r(r(r({},n),t),{},{updatedAt:Date.now()})):o.set(t.id,r(r({},t),{},{createdAt:Date.now()}))}}),Array.from(o.values())}function g(t,n){t.metadata.totalRecords[n]=t[n].length,t.metadata.lastSync[n]=Date.now(),"opportunities"===n&&function(t){var n={prospecting:0,qualification:0,proposal:0,negotiation:0,closedWon:0,closedLost:0};t.opportunities.forEach(function(t){var o,e=t.stage;if(e){var r=(o=e)&&{prospecting:"prospecting",qualification:"qualification",proposal:"proposal",negotiation:"negotiation","closed won":"closedWon",closed_won:"closedWon","closed lost":"closedLost",closed_lost:"closedLost"}[o.toLowerCase()]||null;r&&n.hasOwnProperty(r)&&n[r]++}}),t.metadata.opportunityStages=n}(t)}function b(){var t,n,o="function"==typeof Symbol?Symbol:{},e=o.iterator||"@@iterator",r=o.toStringTag||"@@toStringTag";function c(o,e,r,c){var s=e&&e.prototype instanceof i?e:i,u=Object.create(s.prototype);return h(u,"_invoke",function(o,e,r){var c,i,s,u=0,l=r||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(n,o){return c=n,i=0,s=t,p.n=o,a}};function d(o,e){for(i=o,s=e,n=0;!f&&u&&!r&&n<l.length;n++){var r,c=l[n],d=p.p,y=c[2];o>3?(r=y===e)&&(s=c[(i=c[4])?5:(i=3,3)],c[4]=c[5]=t):c[0]<=d&&((r=o<2&&d<c[1])?(i=0,p.v=e,p.n=c[1]):d<y&&(r=o<3||c[0]>e||e>y)&&(c[4]=o,c[5]=e,p.n=y,i=0))}if(r||o>1)return a;throw f=!0,e}return function(r,l,y){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,y),i=l,s=y;(n=i<2?t:s)||!f;){c||(i?i<3?(i>1&&(p.n=-1),d(i,s)):p.n=s:p.v=s);try{if(u=2,c){if(i||(r="next"),n=c[r]){if(!(n=n.call(c,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=c.return)&&n.call(c),i<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),i=1);c=t}else if((n=(f=p.n<0)?s:o.call(e,p))!==a)break}catch(n){c=t,i=1,s=n}finally{u=1}}return{value:n,done:f}}}(o,r,c),!0),u}var a={};function i(){}function s(){}function u(){}n=Object.getPrototypeOf;var l=[][e]?n(n([][e]())):(h(n={},e,function(){return this}),n),f=u.prototype=i.prototype=Object.create(l);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,h(t,r,"GeneratorFunction")),t.prototype=Object.create(f),t}return s.prototype=u,h(f,"constructor",u),h(u,"constructor",s),s.displayName="GeneratorFunction",h(u,r,"GeneratorFunction"),h(f),h(f,r,"Generator"),h(f,e,function(){return this}),h(f,"toString",function(){return"[object Generator]"}),(b=function(){return{w:c,m:p}})()}function h(t,n,o,e){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}h=function(t,n,o,e){function c(n,o){h(t,n,function(t){return this._invoke(n,o,t)})}n?r?r(t,n,{value:o,enumerable:!e,configurable:!e,writable:!e}):t[n]=o:(c("next",0),c("throw",1),c("return",2))},h(t,n,o,e)}function m(t,n,o,e,r,c,a){try{var i=t[c](a),s=i.value}catch(t){return void o(t)}i.done?n(s):Promise.resolve(s).then(e,r)}function w(t){return function(){var n=this,o=arguments;return new Promise(function(e,r){var c=t.apply(n,o);function a(t){m(c,e,r,a,i,"next",t)}function i(t){m(c,e,r,a,i,"throw",t)}a(void 0)})}}function O(){return(O=w(b().m(function t(n,o){var e,r,c;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,e=n.objectType,r=n.data,t.n=1,d(e,r);case 1:o({success:!0}),t.n=3;break;case 2:t.p=2,c=t.v,console.error("Error saving extracted data:",c),o({success:!1,error:c.message});case 3:return t.a(2)}},t,null,[[0,2]])}))).apply(this,arguments)}function j(){return(j=w(b().m(function t(n,o){var e,r,c,a,i;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,e=n.objectType,r=n.recordId,t.n=1,chrome.storage.local.get("salesforce_data");case 1:if(c=t.v,!(a=c.salesforce_data||_())[e]){t.n=3;break}return a[e]=a[e].filter(function(t){return t.id!==r}),a.metadata.totalRecords[e]=a[e].length,a.metadata.lastSync[e]=Date.now(),"opportunities"===e&&S(a),t.n=2,chrome.storage.local.set({salesforce_data:a});case 2:o({success:!0}),t.n=4;break;case 3:o({success:!1,error:"Object type not found"});case 4:t.n=6;break;case 5:t.p=5,i=t.v,console.error("Error deleting record:",i),o({success:!1,error:i.message});case 6:return t.a(2)}},t,null,[[0,5]])}))).apply(this,arguments)}function S(t){var n={prospecting:0,qualification:0,proposal:0,negotiation:0,closedWon:0,closedLost:0};t.opportunities.forEach(function(t){var o,e=t.stage;if(e){var r=(o=e)&&{prospecting:"prospecting",qualification:"qualification",proposal:"proposal",negotiation:"negotiation","closed won":"closedWon",closed_won:"closedWon","closed lost":"closedLost",closed_lost:"closedLost"}[o.toLowerCase()]||null;r&&n.hasOwnProperty(r)&&n[r]++}}),t.metadata.opportunityStages=n}function _(){return{leads:[],contacts:[],accounts:[],opportunities:[],tasks:[],metadata:{lastSync:{leads:null,contacts:null,accounts:null,opportunities:null,tasks:null},totalRecords:{leads:0,contacts:0,accounts:0,opportunities:0,tasks:0},opportunityStages:{prospecting:0,qualification:0,proposal:0,negotiation:0,closedWon:0,closedLost:0}}}}chrome.storage.onChanged.addListener(function(t,n){"local"===n&&t.salesforce_data&&chrome.tabs.query({},function(n){n.forEach(function(n){chrome.tabs.sendMessage(n.id,{type:"STORAGE_UPDATED",data:t.salesforce_data.newValue}).catch(function(){})})})}),chrome.runtime.onMessage.addListener(function(t,n,o){return"EXTRACT_DATA"===t.type?(function(t,n,o){chrome.tabs.query({active:!0,currentWindow:!0},function(t){t[0]?chrome.scripting.executeScript({target:{tabId:t[0].id},files:["content/contentScript.js"]},function(){o({success:!0})}):o({error:"No active tab found"})})}(0,0,o),!0):"GET_STORAGE"===t.type?(chrome.storage.local.get("salesforce_data",function(t){o(t.salesforce_data||{leads:[],contacts:[],accounts:[],opportunities:[],tasks:[],metadata:{lastSync:{leads:null,contacts:null,accounts:null,opportunities:null,tasks:null},totalRecords:{leads:0,contacts:0,accounts:0,opportunities:0,tasks:0},opportunityStages:{prospecting:0,qualification:0,proposal:0,negotiation:0,closedWon:0,closedLost:0}}})}),!0):"UPDATE_STORAGE"===t.type?(chrome.storage.local.set({salesforce_data:t.data},function(){o({success:!0})}),!0):"SAVE_EXTRACTED_DATA"===t.type?(function(t,n){O.apply(this,arguments)}(t,o),!0):"DELETE_RECORD"===t.type?(function(t,n){j.apply(this,arguments)}(t,o),!0):void 0})})();